@page "/Matches"
@using AnglingClubShared.Entities
@using AnglingClubShared.Enums
@using AnglingClubShared.Models
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Grids
@using Microsoft.AspNetCore.Authorization
@using static AnglingClubWebsite.Pages.MatchesViewModel
@inherits MvvmComponentBase<MatchesViewModel>

<AuthorizationRequired>
  <div style="display: block !important;">
      <h3 class="left-header">Matches</h3>
      <div class="@(ViewModel.IsMobile ? "edit-button-panel" : "desktop-season-selector")">
          @if (ViewModel.RefDataLoaded)
          {
              <span style="display: inline-flex">Season</span>
              <SfDropDownList TValue="Season"
              TItem="SeasonInfo"
              Placeholder="Season"
              Width="100px"
              FloatLabelType="FloatLabelType.Never"
              DataSource="@ViewModel.RefData!.Seasons"
              @bind-Value="@ViewModel.SelectedSeason">
                  <DropDownListFieldSettings Value="Season" Text="Name"></DropDownListFieldSettings>
                  <DropDownListEvents TValue="Season" TItem="SeasonInfo" ValueChange="OnSeasonChange"></DropDownListEvents>
              </SfDropDownList>
          }
      </div>
  </div>
  <br />
  @if (ViewModel.IsMobile)
  {
      <br />
  }

  <p>You can see more details of each match and the results by selecting <i class="fa-solid fa-circle-info" style="color: #1976d2;"></i> next to each match.</p>

    <SfTab ID="Tab" EnablePersistence="true">
      <TabEvents Selected="OnTabSelected"></TabEvents>
      <TabItems>
          @foreach (MatchTabData Item in ViewModel.MatchTabItems)
          {
              <TabItem>
                  <HeaderTemplate>
                      <div>@(Item.Header)</div>
                  </HeaderTemplate>
              </TabItem>
          }
      </TabItems>
  </SfTab>


    <div style="position:relative; min-height: 500px;">

        <SfMediaQuery @bind-ActiveBreakPoint="activeBreakpoint" />

        @if (activeBreakpoint == "Small")
        {
            Width = "100%";
            IsVisible = false;
        }
        else if (activeBreakpoint == "Medium")
        {
            Width = "70%";
            IsVisible = true;
        }
        else
        {
            Width = "50%";
            IsVisible = true;
        }

        <SfGrid DataSource="@ViewModel.Matches" AllowSorting="true" AllowFiltering="false" AllowTextWrap="true"
                Height="100%" Width="@Width"  >

            <GridFilterSettings Type="@Syncfusion.Blazor.Grids.FilterType.Excel" />

            <GridColumns>
                <GridColumn Field=@nameof(ClubEvent.Date) HeaderText="Date" Format="dd MMM yy" Type="Syncfusion.Blazor.Grids.ColumnType.Date" Width="85"/>
                <GridColumn Field=@nameof(ClubEvent.Time) HeaderText="Time" Width="65" />
                <GridColumn Field=@nameof(ClubEvent.Description) HeaderText="Venue"  />
                <GridColumn Field=@nameof(ClubEvent.Cup) Visible="@IsVisible" HeaderText="Cup" />
                <GridColumn Field=@nameof(ClubEvent.Number) HeaderText="No" Format="N0" Width="50" />
            </GridColumns>

        </SfGrid>

    </div>


  <!-- Note: For some reason, these styles only work when applied in the html file.
  They get ignored in both scoped CSS and app-level CSS.
  -->
  <style>
      .e-tab .e-tab-header:not(.e-vertical) .e-toolbar-item.e-active {
      border-bottom: 3px solid #1976d2;
      color: #6610f2 !important;
      font-weight: bold !important;
      }

      .e-tab .e-tab-header .e-toolbar-item .e-tab-wrap {
      color: #62b4fd;
      padding: 0 6px;
      }

      .e-tab .e-tab-header::before {
      border-color: #CCFBF1;
      }

      .e-tab .e-tab-header .e-toolbar-item.e-active {
      border: 1px solid #CCFBF1;
      }

      .e-tab-text {
      font-size: 12px !important;
      font-weight: 600 !important;
      color: darkslategray !important;
      }

      .e-active .e-tab-text {
      font-size: 12px !important;
      font-weight: bold !important;
      color: black !important;
      }

  </style>
</AuthorizationRequired>

@code {
    private string? activeBreakpoint { get; set; }
    public bool IsVisible { get; set; }
    public string Width { get; set; } = "100%";

    public void OnTabSelected(SelectEventArgs args)
    {
        Console.WriteLine($"Selected item: {args.SelectedIndex} - {ViewModel.MatchTabItems.ToArray()[args.SelectedIndex].MatchType}");
        ViewModel.SelectedMatchType = ViewModel.MatchTabItems.ToArray()[args.SelectedIndex].MatchType;
        ViewModel.LoadMatches();
    }

    public async Task OnSeasonChange(ChangeEventArgs<Season, SeasonInfo> args)
    {
        Console.WriteLine("The DropDownList Value is: ", args.Value);
        await ViewModel.GetMatches();

    }


}
